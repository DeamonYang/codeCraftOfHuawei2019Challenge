# codeCraftOfHuawei2019Challenge
华为2019软件精英挑战赛

## 运行说明
### 测试数据集
运行命令行：
```commandline
python CodeCraft-2019.py ../config_test/car_test.txt ../config_test/road_test.txt
 ../config_test/cross_test.txt ../config_test/answer_test.txt 
```

### 训练地图
 - config_1
 - config_2
 
> 将config_*的文件复制到config中，使用命令行：

```commandline
python CodeCraft-2019.py ../config/car.txt ../config/road.txt
 ../config/cross.txt ../answer.txt 
```
## FAQ
1.    无法修改“学校”与”省份”
请确认是否已经组队。当组队后，系统会锁定个人信息中“学校”与“省份”项，不可修改。

2.    无法修改个人信息
请确认当前时间是否已过报名截止时间，本次大赛报名截止时间为3月29日18:00。

3.    无法提交代码
请确认是否组队，同时系统处于可提交代码状态。

系统可提交状态请关注大赛各赛段发布的详细赛程安排。

4.    无法下载赛题与地图
请确认是否组队，同时赛题和地图是已发布状态。

赛题和地图是已发布状态请关注大赛各赛段发布的详细赛程安排。

5.    无法组队
请确认个人信息是否完善，组队的各成员同属于一个赛区且任何人当前没有组队。

6.    无法启动任务
请确认是否已提交代码，同时系统已发布训练或正式地图。

地图是否已发布状态请关注大赛各赛段发布的详细赛程安排。

7.    大赛网站点击“论坛”链接，出现跳转错误后的处理办法
在大赛网站多次点击“论坛”跳转会出现如下错误，请“清空浏览器缓存”后重新点击“论坛”重试，错误如下图所示：

image.png

8.    代码上传失败
请确认代码包是否符合代码包上传要求，如“代码包上传要求”所示。

9.    代码包上传要求
Ø  每个团队代码上传时间间隔至少1分钟。

Ø  训练赛期间每日上传次数最大限度为100次。

Ø  代码包命名要求不得含有以下合法字符集以外的任何字符。

目录名合法的命名字符集：英文大写字母”A-Z”、英文小写字母”a-z”、数字”0-9”、 英文短横线“-”、 英文下划线”_”、英文加号”+”

Ø  上传的答案压缩包（如CodeCraft_code.tar.gz）中：

目录嵌套层级不得超过10层级

文件路径（文件目录 + 目录分隔符 + 文件名）的长度不得超过255字符

Ø  上传的答案压缩包（如CodeCraft_code.tar.gz）中所包含的文件目录不得含有以下合法字符集以外的任何字符。

目录名合法的命名字符集：英文大写字母”A-Z”、英文小写字母”a-z”、数字”0-9”、 英文短横线“-”、 英文下划线”_”、英文加号”+”

Ø  上传的答案压缩包（如CodeCraft_code.tar.gz）中所包含的文件名不得含有以下合法字符集以外的任何字符，且”.”不能连续出现。

文件名合法的命名字符集：英文大写字母”A-Z”、英文小写字母”a-z”、数字”0-9”、 英文短横线“-”、英文下划线”_”、英文点”.” 、英文加号”+”

 

10.    道路车道数目说明
任务书描述一条道路的车道数目只描述一个方向的国车道数目，另一个方向要么车道数目为0，要么与描述的车道数值相等。比如一个3车道双向道路，表示两个方向均有3个车道。

 对于一个双向道路来讲，两个方向车道号各自独立编号，互不影响。

11.    道路图形化表示
道路不存在立交的情况

每个路口最大连接4条道路

任务书给定系统的输入道路与路口信息，与表述的图形化没有必然对应关系。根据输入的道路和路口信息，可以生成很多任意的图形界面，任务书中图形表示仅仅是以直观的形式去理解，不代表一定是该图形样式

道路在图形上的形状也不做限定要求，可以理解成直的，也可以理解成弯曲的等，只要保证道路的起始点与终止点正确即可

12.    系统精度说明
为简化实现，整个系统实现不考虑小数，全部只考虑整数的情况

系统调度时间最小时间为1个单位时间，不考虑小数

车辆行驶距离最小行驶距离为1，不考虑小数

车辆运行调度，每次必须是一个时间单位，不实现小于1个单位时间的调度。比如一车辆的可以行驶的速度为3，则一次调度一个时间单位行驶距离3，不能1/3、1/3、1/3的时间单位调度且相应行驶1、1、1的情况



13.    文件格式要求
整个系统运行在linux操作系统之上，建议参赛选手输出的答案文件格式统一为UNIX格式


14.    车辆的实际出发时间
车辆的实际出发时间由参赛选手自行决定，但是不得早于车辆的计划出发时间



15.    同路口多条道路车辆调度
同路口多条道路按各条道路的ID升序进行循环调度车辆行驶

整个系统按路口ID升序顺序循环调度 




16.    关于访问华为云论坛账号
参赛选手访问华为云论坛账号，是由大赛平台账号生成访问账号，仅供访问论坛使用，非华为云独立账号，不可直接登陆华为云系统。



17.    参赛选手输出answer.txt格式要求
每条答案数据以“(”起始，以“)”终止，路径中各道路以“,”分隔，中间只可以出现0个或多个空格“ ”，不允许出现其他非法字符。只接受英文","，任务书V1.2中给出的示例有误，误写成了中文"，"，请知。



    如下是任务书中描述错误的中文"，"

#(carId,StartTime,RoadId...)
 (1001, 1， 501, 502, 503, 516, 506, 505, 518, 508, 509, 524)
 (1002, 1， 513, 504, 518, 508, 509, 524)
 (1003, 1， 513, 517, 507, 508, 509, 524)
 (1004, 1， 501, 502, 515, 519, 509, 524)
 (1005, 1， 501, 514, 504, 517, 507, 508, 509, 524)
 (1006, 1， 513, 517, 521, 510, 511, 512)
 (1007, 1， 513, 504, 518, 507, 521, 510, 511, 512)
 (1008, 1， 501, 502, 503, 516, 506, 519, 508, ，522， 511，512)


18.    系统编译与运行时间要求
整个系统限制参赛选手程序编译时间最大为60s，程序运行生成answer.txt时间为300s。

19.    车辆速度约束
为了简化系统设计，车辆速度设定均小于等于所有道路的最小长度，不考虑一个时间调度一个车辆可以越过一条道路的情况。

20.    系统评阅说明


系统要求参赛选手提交可输出所有车辆路径的源代码，系统后台自动进行编译、运行得到answer.txt文件。

系统调用编译生成的可执行代码生成所有车辆的路径。（该步骤运行参赛选手的程序产生所有车辆路径的时间为程序运行时间，单位ms）

系统将选手程序输出的所有车辆的路径作为判题系统的输入，运行判题系统，判题系统输出为系统调度时间和系统总调度时间。

系统请阅时会自动加载地图信息，参赛选手上传源码时无需上传地图目录。

21.    路口输入说明


路口的向量表示，只规定按顺时针顺序约定该路口的各条道路，不约定第一条道路与终最后一条道路具体是哪条，只要保证顺时针顺序就可以。


22.    道路、车辆等输入的最大规模


道路与车辆的规模与整个系统的难度相关，也是此系统的难点之一，恕不便透露，请谅解。


23.    提供SDK的作用


提供的SDK是编译与运行的框架，系统按此框架进行编译与运行，请参赛选手按此框架完成自己的程序。



24.    代码上传要求
请检查上传的压缩包是否符合上传的格式要求，内部各文件夹和文件全部需要符合。
特别提醒，内部隐藏的文件，比如office的临时文件，JAVA生成的带$的class文件（只需要源码即可）



且上传时不需要上传地图文件及地图目录。

25    运行说明


各语言的输入均为文件路径（含文件名），输出也为文件路径（含文件名）

CodeCraft-2019/src/CodeCraft-2019.py map/car.txt map/road.txt map/cross.txt  answer/answer.txt



JAVA启动：com.huawei.Main $(path)/car.txt $(path)/road.txt $(path)/cross.txt $(path)/answer.txt

Python启动：python src/CodeCraft-2019.py $(path)/car.txt $(path)/road.txt $(path)/cross.txt  $(path)/answer.txt

C/C++启动：CodeCraft-2019 $(path)/car.txt $(path)/road.txt $(path)/cross.txt $(path)/answer.txt




26.    任务运行结果无效值的说明


团队任务运行结果100000000000为系统定义的无效值，当任务出现异常时，结果记此无效值。

赛事直播为发布的地图对应的成绩求和，比如两张地图对应的无效的成绩为2000000000000。



任务异常的情况不限于编译失败、运行失败、车辆调度发生死锁、程序运行超时等。



27.    赛事直播成绩说明


目前初赛发布了两张比赛地图，赛事直播页面会对两张地图的成绩求和作为总成绩进行排序。

如果团队任务同一代码运行了两份在图，则直播页面会对两份在图的成绩自动求和。

## 系统调度说明
1、系统调度时间从开始调度进行计算，时间计为0时刻，从0时刻开始计算。每个调度计为一个时间片，一个调度驱动所有车辆行驶一个时间单位。系统调度结束所处的时间片数即为系统调度时间。

2、系统调度最小单位为1个单位，也就是一个时间片，不考虑小数。不会出现1/2见时间单位，1/3时间单位，1/4时间单位等小于一个时间单位的情况。也就是说车辆要么走一个时间单位，要么不走，不会出现车辆先走1/2时间单位，再走1/2时间单位。比如一车辆的可以行驶的速度为3，则一次调度一个时间单位行驶距离3，不能以1/3时间单位、1/3时间单位、1/3时间单位调度且相应行驶距离1、距离1、距离1的情况。

3、车辆最小行驶距离为1，不考虑小数。也就是车辆最小行驶1个单位，不可以先行驶1/2单位，再行驶1/2单位。

4、系统调度先调度在路上行驶的车辆进行行驶，当道路上所有车辆全部不可再行驶后再调度等待上路行驶的车辆。

5、调度等待上路行驶的车辆，按等待车辆ID升序进行调度，进入道路车道依然按车道小优先进行进入。

6、说明一下判题系统的调度处理逻辑：

    第一步：

    该步骤处理所有道路的车辆不影响其他道路上车辆的顺序，因此先调度哪条道路无关紧要。

    先处理每条道路上的车辆，将这些车辆进行遍历扫描，如果车在经过行驶速度（前方没有车辆阻挡）可以出路口，将这些车辆标记为等待行驶车辆。

    车辆如果行驶过程中，前方没有阻挡并且也不会出路口（v=min(最大车速，道路限速)），则该车辆行驶可行驶的最大车速（v=min(最大车速，道路限速)），此时该车辆在本次调度确定了该时刻的终止位置。该车辆标记为终止状态。

    车辆如果行驶过程中，发现前方有车辆阻挡，且阻挡的车辆为等待车辆，则该辆车也被标记为等待行驶车辆。（与阻挡车辆的距离s < v*t)） 其中：v=min(最大车速，道路限速),t=1

    车辆如果行驶过程中，发现前方有车辆阻挡，且阻挡的车辆为终止车辆，则该辆车也被标记为终止车辆。（与前方阻挡的车辆的距离记为s）则该车辆最大行驶速度为v = min(最高车速，道路限速，s/t) 其中t=1，该车辆最大可行驶距离为s。

    遍历道路上车辆由第一排向最后一排进行遍历，确定每辆车的行驶状态。（出道路处为道路第一排，入道路处为是后一排）

    第二步：

    处理所有路口、道路中处于等待状态的车辆，等待车辆的调度顺序按7、8、9进行调度。


7、整个系统调度按路口ID升序进行调度各个路口，路口内各道路按道路ID升序进行调度。

        while(not all car are end state){

            for (all crosses){

                for (roads in cross){

                    runCar();

                    ...

                } 

            }

        }

     每个路口遍历道路时，只调度该道路出路口的方向。

     如图所示则调度路口5时，只调度道路500从路口6到路口5的方向；调度路口6时，只调度道路500从路口5到路口6的方向。

     如：路口5 <-----500------  路口6 

            路口5 ------500----->  路口6

            道路500的起始点为路口5，终止点为路口6      

8、道路内部车辆调度按任务书给定的优先顺序进行调度。

     在每次调度中，调度到的车辆要么行驶其可行驶的最大车速，要么就会因等待其他车辆行驶而处于等待行驶状态，待所等待行驶的车辆行驶后，再使该车辆行驶其可行驶的最大车速。

    是否发生冲突，只与相关道路的第一优先级车辆的行驶方向进行比较，看是否发生冲突。   

    每条道路如果当前道路第一优先级车辆不能行驶，则当前道路后面的的车辆都不能行驶，只有第一优先级的车辆行驶了，后面第二优先级才可以确定是否可以行驶。 

2019-3-13：

    每个道路（道路R）一旦有一辆等待车辆（记为车A，所在车道记为C）通过路口而成为终止状态，则会该道路R的车道C上所有车辆进行一次调度，如第一步所示，仅仅处理该道路该车道上能在该车道内行驶后成为终止状态的车辆（对于调度后依然是等待状态的车辆不进行调度，且依然标记为等待状态）

    ----尽可能多、尽可能快地将车辆确定为终止状态

   （本车道内将可以达到终止状态主要目的是尽快让出空位让其他道路的车辆可以进入该道路，同时会重新识别真正等待出路口的车辆，因为有些车辆是因为前车是等待状态而导致自己也是等待状态，有可能他自己这次根本不会出路口，也就是不参与出路口的优先级排序---只有出路口的车辆才参与优先级排序）

    假定道路有如下车辆，车AB车速为3，CD均为车速为1

    A空空B空空CD   （路口）

    按步骤一后ABCD均为等待状态。

    在处理待状态车辆D后，假定D前进到其他道路后，此刻道路状态变化为A空空B空空C空   （路口）

    接下来因D车辆的前进后，需要对该条道路该车道的所有车辆进行一次调度，只调度经过一次调度会依然在该车道内车辆且状态为终止状态（不出路口）

    因此：

    C的车速为1，则C车前进1个距离，且为终止状态。A空空B空空空C   （路口）

    B的车速为3，则B车前进3个距离，且为终止状态。A空空空空空BC   （路口）

    A的车速为3，则A车前进3个距离，且为终止状态。空空空A空空BC   （路口）



   调度后道路车辆分布为：空空空A空空BC   （路口），且ABC均为终止状态

9、一个时间单位内，一次调度时7与8的调度会出现多次重复调度，因每次调度有可能因为等待其他道路车辆的行驶而导致当前车辆无法行驶，因此会循环调度使所有车辆行驶一个时间单位。

     每次调度到一条道路，直到该道路无车辆可调度，或该条道路上车辆处于冲突状态。也就是说尽可能多地让该道路上的车辆行驶，直到没有车辆或者车辆与其他车辆发生冲突不可行驶。

     如果本次循环因冲突失去调度权限，则需要等下一次循环，此道路才会获得调度权限。当一个条道路获得调度权限时，尽可能多地让此道路的车辆进行行驶。

     依次按道路ID升序调度该路口所连接的所有道路，再次循环该路口下所有道路，直到所有道路车辆全部处于终态

10、每次车辆调度，该车辆要么不走，要么行驶其可行驶的最大车速。不存在该车辆先走0.5时间单位，再走0.5时间单位的情况。

11、基于10，参赛选手需要注意，一次调度能使所有车辆均到达各车辆的行驶速度行驶，就得保证不能出现各车辆循环等待的情况，否则该次调度就会锁死。循环等待是指比如车辆A等待车辆B，车辆B等待车辆C，车辆C等待车辆D，车辆D等待车辆E，车辆E等待车辆F，车辆F等待车辆A的情况。

a)         假定下图各车辆100、200、300、400、500、600、700、800车速均为6，图中各道路限速均为8，车辆100、300、500、700均为右转。

b)        图中各条道路长度均为10

c)         因车辆100右转，需要等待车辆800的前行而导致车辆100处于等待状态

d)        因车辆100处于等待状态，而导致车辆200也必须处于等待状态

e)         相同的原因车辆700处于等待状态，车辆800也处于等待状态

f)         同理，车辆300、400、500、600均处于等待状态

g)        如下图中车辆100、200、300、400、500、600、700、800均处于等待状态，形成循环等待

如此，下图中各车辆处于相互锁定状态

                                              死锁.png

12、为简化实现，整个系统不存在小数。也就是不存在车辆实际出发时间为小数、调度为小数、行驶距离为小数、车辆速度为小数等。


13、给出如下图例说明一下路口调度顺序：

       假定各道路均为双向道路，且每条道路长度为20（因便于图中仅标示出来长度5）

       图中双黄线为道路中间线，假定双黄线左侧道路全部是空车道，没有车辆阻挡，能够容纳所有进入的车辆（图中仅标示出来长度为5，假定长度为20）。

       假定下图各道路车辆全部处于等待状态。

多道路排序.png

1、道路编号如图所示5000、5001、5010、5018

2、车辆编号前方各字母表示方向，不体现在车辆编号中。D：直行；L：左转；R：右转

3、车辆编号为字母后纯数字

4、在本路口调度道路的顺序为5000、5001、5010、5018、5000、5001、5010、5018、5000、5001、5010、5018...5000、5001、5010、5018

5、假设4条道路上所有车辆均可以通过路口，则车辆调度顺序如下：

D100、D200、D201、D202、L203、L204、R205、R206、D207、R208、D400、D401、L402、L403、L404、R405、R406、D407、D408、L101、L300、L301、R302、R303、D304、R305、R306、L307、D308、R102、L103、D104、D105、D106、R107、R108

     首先调度5000道路，只有D100可以走，因为D101左转与5010道路的D200冲突，所以必须等待5010车道上没有直行冲突。

     其次再调度5001道路，因5001道路的L300与道路5018的D400冲突，所以L300必须等待道路5018的D400先行后再调度行驶。

     再次调度道路5010，D200、D201、D202不与其他道路的车辆冲突，可以直接行驶。L203左转，且道路5001无左转车辆与其冲突，因此L203可以左转。L204也可以左转。L205为右转，与左侧道路5000的车辆L101不冲突（只与道路5000的直行会发生冲突），且与道路5018的D400不发生冲突（只与道路5018的左转车辆发生冲突），因此车辆L205可以右转，依次道路5010上的剩余车辆全部可以通过。

    说明：这里假定每调度一辆等待车辆达到终态，都会确定该车道后续车辆有没有因为该等待车辆的前进，而可以在本车道内前进且达到终止状态的车辆（本车道内将可以达到终止状态主要目的是尽快让出空位让其他道路的车辆可以进入该道路，同时会重新识别真正等待出路口的车辆，因为有些车辆是因为前车是等待状态而导致自己也是等待状态，有可能他自己这次根本不会出路口，也就是不参与出路口的优先级排序）。同时假定每一次这样的调度该车道的车辆均没有任何一辆可以到达终止状态，全部依然处于等待状态（也就是后续车辆的位置和状态没有发生任何变化）。

     接着调度5018道路上的车辆.....

     再调度道路5000....

     再调度道路5001...

     再调度道路5000....

    （这里每一辆等待车辆调度行驶达到终态，都会进行“说明”部分的操作）

     是否发生冲突，只与相关道路的第一优先级车辆的行驶方向进行比较，看是否发生冲突。

    每次调度到一条道路，直到该道路无车辆可调度，或该条道路上车辆处于冲突状态。也就是说尽可能多地让该道路行驶，直到没有车辆或者车辆与其他车辆发生冲突不可行驶。

附伪码(判题器)：（输入为car.txt,cross.txt,road.txt answer.txt， 输出为调度时间，总调度时间）


        for(/* 按时间片处理 */) {
            while(/* all car in road run into end state */){
                foreach(roads) {
                    /* 调整所有道路上在道路上的车辆，让道路上车辆前进，只要不出路口且可以到达终止状态的车辆
                     * 分别标记出来等待的车辆（要出路口的车辆，或者因为要出路口的车辆阻挡而不能前进的车辆）
                     * 和终止状态的车辆（在该车道内可以经过这一次调度可以行驶其最大可行驶距离的车辆）*/
                    driveAllCarJustOnRoadToEndState(allChannle);/* 对所有车道进行调整 */

                    /* driveAllCarJustOnRoadToEndState该处理内的算法与性能自行考虑 */
                }
			}
            
            while(/* all car in road run into end state */){
                /* driveAllWaitCar() */
                foreach(crosses){
                    foreach(roads){
			while(/* wait car on the road */){
			    Direction dir = getDirection();
			    Car car = getCarFromRoad(road, dir);
			    if (conflict){
			    	break;
			    }

			    channle = car.getChannel();
			    car.moveToNextRoad();

			    /* driveAllCarJustOnRoadToEndState该处理内的算法与性能自行考虑 */
			    driveAllCarJustOnRoadToEndState(channel);
			}
		    }
                }
            }

            /* 车库中的车辆上路行驶 */
            driveCarInGarage();
        }

如果团队任务仅运行一张地图，则直播页面的总成绩默认会将一份地图的成绩按无效值处理。

请各团队针对每一份代码选择两份地图进行运行任务，这样子直播页面总成绩就会取各个地图对应的成绩进行求和。


     

28.    任务运行错误提示说明
  Programe runs too long： 1、选手的程序运行超过5分钟 2、判题器运行时间超时（远大于5分钟）

  Programe runs failed：选手的程序运行失败

  answer error：1、选手的程序运行生成的答案超过系统大小限制 2、选手的程序运行结束，但是未生成answer.txt

  system error：因网络连接原因导致系统连接出现异常，非参赛选手的原因，请参赛选手重新运行任务即可。

  其余的有具体的错误信息，阅读具体提示信息（编译错误、判题错误）


29.    常见的运行任务错误及原因分析


所有语言C/C++、python、java语言SDK中定义了输入与输出接口（参考FAQ 25条说明），请参赛选手不要修改程序的输出与输出接口，务必遵守约定。

SDK中python样例没有自动创建log文件，如果上传时删除了对应层级的log目录和文件会导致运行失败，建议参赛选手在本地调试时保留日志接口，上传网站时将代码中日志相关的代码删除，以免因未创建日志文件而导致失败。

文件上传失败多见于上传的压缩包中有不符合格式要求的文件或目录，请注意检查。

比如使用MAC打包时会自动生成隐藏文件，未删除SDK中所带的所有地图目录，压缩包中含有中文文件，office临时文件（~开头文件）等

偶发性遇到过python语言的参选选手在本地输出的路径格式正确，但是在网站平台运行后生成的answer.txt时，车号在最后，实际出发时间次之的情况，与使用的numpy数据结构的字典顺序有关，请核实。

python偶见一参赛选手代码使用空格和TAB缩进混用导致运行失败的，请各位python选手注意。

网站提示"Car(XXX) does not included by thw answer"，如果XXX是第一辆车，则可能是生成的answer.txt为空文件。如果XXX非第一辆车，则可能是对应的路径不符合格式要求"(XXX,X,XXX,XXX,XXX)"。如果XXX压根不是车号，刚说明生成的answer.txt紊乱。

C/C++语言运行失败常见于“段错误”、“CoreDump”等，建议各位选手在上传前在自己本地linux系统调试一下自己的代码，保证使用SDK中提供的编译脚本可编译，按SDK运行要求可运行生成answer.txt。